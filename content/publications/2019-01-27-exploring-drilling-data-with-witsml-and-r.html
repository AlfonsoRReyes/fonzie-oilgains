---
title: "Exploring drilling data from the Volve dataset with WITSML and R"
author: "Alfonso R. Reyes"
date: '2019-01-27'
slug: exploring-drilling-data-with-witsml-and-r
tags: []
categories:
- drilling
- data structures
---



<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>This time we will exploring drilling data that is stored using the industry standard <a href="https://www.energistics.org/portfolio/witsml-data-standards/">WITSML</a>. This format is widely used in the industry in drilling, completion and intervention operations, specifically for real-time surveillance. WITSML stands for <em>Wellsite Information Transfer Standard Markup Language</em>. It has a series of rules to save the data as a consistent schema but essentially is XML. Software developers and IT professionals in the oil industry know it very well. They mostly use in-house developed scripts, SDK<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> in Java, [.Net]<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>, [C#]<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>, or applications provided by vendors. This standard is essential to send and receive data between the rig and the offices or servers.</p>
<p>Since we are not writing for software developers or IT techs but for <strong>petroleum engineers</strong>, we need to know at least the basics of WITSML. Don’t need to be experts on the subject but at least get familiar with the shape of the data, manipulation, perform some data exploration, and ultimately, be prepared, or know, what they are talking about when it is time to build an artificial intelligence agent based on a machine learning algorithm.</p>
<blockquote>
<p>On Artificial Intelligence. Again, let’s touch Earth here. There is no robot, or Terminator, or an intelligent, cognitive entity. Artificial Intelligence or AI is about making agents or applications to perform a repetitive or boring tasks that otherwise would be peformed by a human being. It is simple math, statistics and computer science.</p>
</blockquote>
</div>
<div id="motivation" class="section level1">
<h1>Motivation</h1>
<p>I have always been intrigued by <code>WITSML</code>. Not being a drilling engineer kepts me some distance away from the daily touch with this type of data. When I had the chance, I have explored the WITSML data with a XML viewer and one thing is clear: this is not your regular nice, rectangular data, or table, that we work every day. WITSML uses a <a href="https://medium.freecodecamp.org/all-you-need-to-know-about-tree-data-structures-bceacb85490c">hierarchical</a> data structure, pretty similar to a tree: branches and leaves. This makes it very unusual to those who are familiar with just row and columns tables. What we will try to do in this lecture is getting a basic understanding of a different <a href="https://en.wikipedia.org/wiki/Data_structure">data structure</a>. As a matter of fact, I find <em>hierarchical data structures</em> very applicable to production and reservoir engineering because they give us a lot of freedom in creating multiple levels for our data.</p>
</div>
<div id="witsml-and-the-volve-dataset" class="section level1">
<h1>WITSML and the Volve Dataset</h1>
<p>We were very fortunate of getting the <a href="https://www.equinor.com/en/news/14jun2018-disclosing-volve-data.html">Volve dataset</a> published 7 months ago. It covers a wide array of data from different disciplines (production, reservoir, geophysics, drilling, completion, logging, etc.), with data coming in different formats. It is a very good exercise of data science for exploring the data and making discoveries.</p>
<p>Here is a view of all the wells that are storing data in WITSML format:</p>
<p><img src="/img/witsml-all_wells.png" width="450px" style="display: block; margin: auto;" /></p>
<p>Look at the size of each folder. They are considerable large if we compare to the usual files we manage every day. I am choosing the folder in row 22, one of the smaller data containers. If the data operations we perform here are all correct, then they should apply to any of the larger WITSML datasets.</p>
<p><img src="/img/witsml-typical_well.png" width="300px" style="display: block; margin: auto;" /></p>
<p>A typical well with data stored in WITSML would look like this:</p>
<p><img src="/img/witsml-typical_well.png" width="300px" style="display: block; margin: auto;" /></p>
<p>From all these folders, let’s focus today in the <strong>well trajectory</strong> dataset. I downloaded all the drilling data for Volve which is about 26.8 GB. Not that big if we compare to the seismic files of 1.2 and 2.4 terabytes. I chose the <code>trajectory</code> folder for well <code>Norway-Statoil-NO 15_$47$_9-F-9</code> because it seems complex enough to studying it. Besides, it wasn’t too big: around 27 MB. After learning from it, we could apply our data conversion algorithms to simpler datasets.</p>
</div>
<div id="the-trajectory-folder-and-files" class="section level1">
<h1>The <code>trajectory</code> folder and files</h1>
<p>The <code>trajectory</code> folder is very simple. It contains WITSML files and a metadata information file (not important at this time). The folder could contain more than one file. We will see in another lecture wells with more than one trajectory file. In our example, the WITSML file has the name of <code>1.xml</code>. We will be reading it in few seconds.</p>
<p><img src="/img/witsml-trajectory_folder.png" width="500px" style="display: block; margin: auto;" /></p>
</div>
<div id="data-operations" class="section level1">
<h1>Data operations</h1>
<p>Let’s take a look first at the <code>trajectory</code> WITSML file. We are starting with a collapsed tree so it doesn’t take too much space of the screen. The <code>(+)</code> signs on the left means that it willl expand at that node.</p>
<p><img src="/img/witsml-collapsed.png" width="500px" style="display: block; margin: auto;" /></p>
<p>Some of these nodes will have children, others will just contain values as is the case of the nodes that go from <code>nameWell</code> up to <code>aziRef</code>.</p>
<p><img src="/img/witsml-orphans.png" width="500px" style="display: block; margin: auto;" /></p>
<p>The node <code>trajectoryStation</code> has also child nodes as we show below for the first child member.</p>
<p><img src="/img/witsml-trajectoryStation.png" width="600px" style="display: block; margin: auto;" /></p>
<p>Note that on the right of <code>trajectoryStation</code> there is a keyword named <code>uid</code>. This is called an <strong>attribute</strong> of the node. In this particular case, that <code>uid</code> is the unique identifier of that measurement point. All of them are unique.</p>
<p>Another interesting finding is that not all <code>trajectoryStation</code> nodes have the same number of variables. Compare the figure above with this coming from a similarly named node:</p>
<p><img src="/img/witsml_tS_complete.png" width="500px" style="display: block; margin: auto;" /></p>
<p>This hierarchical structure, as we can see, is very flexible. If there are not values, or measurements, they will not take space during storage. In tables or dataframes, they would usually be present but filled with <strong>NA</strong>s.</p>
<div id="reading-a-witsml-file" class="section level2">
<h2>Reading a WITSML file</h2>
<p>We will use two packages: <code>xml2</code>, <code>data.table</code> and <code>dplyr</code>. <code>xml2</code> will take care of reading the WITSML files, while <code>dplyr</code> and <code>data.table</code> will be our workhorses for dataframe generation and data manipulation.</p>
<pre class="r"><code>library(xml2)
library(data.table)
library(dplyr)</code></pre>
<pre class="r"><code>witsml_dir &lt;- &quot;./witsml&quot;
all_files_xml &lt;- list.files(witsml_dir, recursive = TRUE, full.names = TRUE, 
                        include.dirs = TRUE, pattern = &quot;*.xml&quot;)

# indices in R start at 1, not zero as in Python
all_files_xml[73:83]
#&gt;  [1] &quot;./witsml/Norway-Statoil-NO 15_$47$_9-F-9/1/message/55.xml&quot;  
#&gt;  [2] &quot;./witsml/Norway-Statoil-NO 15_$47$_9-F-9/1/message/56.xml&quot;  
#&gt;  [3] &quot;./witsml/Norway-Statoil-NO 15_$47$_9-F-9/1/message/6.xml&quot;   
#&gt;  [4] &quot;./witsml/Norway-Statoil-NO 15_$47$_9-F-9/1/message/7.xml&quot;   
#&gt;  [5] &quot;./witsml/Norway-Statoil-NO 15_$47$_9-F-9/1/message/8.xml&quot;   
#&gt;  [6] &quot;./witsml/Norway-Statoil-NO 15_$47$_9-F-9/1/message/9.xml&quot;   
#&gt;  [7] &quot;./witsml/Norway-Statoil-NO 15_$47$_9-F-9/1/rig/1.xml&quot;       
#&gt;  [8] &quot;./witsml/Norway-Statoil-NO 15_$47$_9-F-9/1/trajectory/1.xml&quot;
#&gt;  [9] &quot;./witsml/Norway-Statoil-NO 15_$47$_9-F-9/1/tubular/1.xml&quot;   
#&gt; [10] &quot;./witsml/Norway-Statoil-NO 15_$47$_9-F-9/1/tubular/2.xml&quot;   
#&gt; [11] &quot;./witsml/Norway-Statoil-NO 15_$47$_9-F-9/1/wbGeometry/1.xml&quot;</code></pre>
<p>We get lots of XML files under the folder <code>witsml</code>. Let’s focus our attention in the <code>trajectory</code> files.</p>
<pre class="r"><code># get the file for trajectory
traj_files &lt;- grep(pattern = &quot;trajectory&quot;, ignore.case = TRUE, 
                   value = TRUE, x = all_files_xml)
traj_files
#&gt; [1] &quot;./witsml/Norway-Statoil-NO 15_$47$_9-F-9/1/trajectory/1.xml&quot;</code></pre>
<pre class="r"><code># get the name of the root node
dat &lt;- read_xml(traj_files[1])
xml_name(dat)
#&gt; [1] &quot;trajectorys&quot;</code></pre>
<pre class="r"><code># name of the child node
xml_name(xml_children(dat))
#&gt; [1] &quot;trajectory&quot;</code></pre>
<pre class="r"><code># strip default namespaces from the document
xml_ns_strip( dat )
dat %&gt;% 
    xml_find_all( &#39;//*&#39;) %&gt;% 
    xml_path() %&gt;% 
    .[1:50]                   # show the first 100 elements
#&gt;  [1] &quot;/trajectorys&quot;                                                          
#&gt;  [2] &quot;/trajectorys/trajectory&quot;                                               
#&gt;  [3] &quot;/trajectorys/trajectory/nameWell&quot;                                      
#&gt;  [4] &quot;/trajectorys/trajectory/nameWellbore&quot;                                  
#&gt;  [5] &quot;/trajectorys/trajectory/name&quot;                                          
#&gt;  [6] &quot;/trajectorys/trajectory/objectGrowing&quot;                                 
#&gt;  [7] &quot;/trajectorys/trajectory/dTimTrajStart&quot;                                 
#&gt;  [8] &quot;/trajectorys/trajectory/dTimTrajEnd&quot;                                   
#&gt;  [9] &quot;/trajectorys/trajectory/mdMn&quot;                                          
#&gt; [10] &quot;/trajectorys/trajectory/mdMx&quot;                                          
#&gt; [11] &quot;/trajectorys/trajectory/magDeclUsed&quot;                                   
#&gt; [12] &quot;/trajectorys/trajectory/gridCorUsed&quot;                                   
#&gt; [13] &quot;/trajectorys/trajectory/aziVertSect&quot;                                   
#&gt; [14] &quot;/trajectorys/trajectory/dispNsVertSectOrig&quot;                            
#&gt; [15] &quot;/trajectorys/trajectory/dispEwVertSectOrig&quot;                            
#&gt; [16] &quot;/trajectorys/trajectory/aziRef&quot;                                        
#&gt; [17] &quot;/trajectorys/trajectory/trajectoryStation[1]&quot;                          
#&gt; [18] &quot;/trajectorys/trajectory/trajectoryStation[1]/dTimStn&quot;                  
#&gt; [19] &quot;/trajectorys/trajectory/trajectoryStation[1]/typeTrajStation&quot;          
#&gt; [20] &quot;/trajectorys/trajectory/trajectoryStation[1]/md&quot;                       
#&gt; [21] &quot;/trajectorys/trajectory/trajectoryStation[1]/tvd&quot;                      
#&gt; [22] &quot;/trajectorys/trajectory/trajectoryStation[1]/incl&quot;                     
#&gt; [23] &quot;/trajectorys/trajectory/trajectoryStation[1]/azi&quot;                      
#&gt; [24] &quot;/trajectorys/trajectory/trajectoryStation[1]/dispNs&quot;                   
#&gt; [25] &quot;/trajectorys/trajectory/trajectoryStation[1]/dispEw&quot;                   
#&gt; [26] &quot;/trajectorys/trajectory/trajectoryStation[1]/vertSect&quot;                 
#&gt; [27] &quot;/trajectorys/trajectory/trajectoryStation[1]/dls&quot;                      
#&gt; [28] &quot;/trajectorys/trajectory/trajectoryStation[1]/commonData&quot;               
#&gt; [29] &quot;/trajectorys/trajectory/trajectoryStation[1]/commonData/sourceName&quot;    
#&gt; [30] &quot;/trajectorys/trajectory/trajectoryStation[1]/commonData/dTimCreation&quot;  
#&gt; [31] &quot;/trajectorys/trajectory/trajectoryStation[1]/commonData/dTimLastChange&quot;
#&gt; [32] &quot;/trajectorys/trajectory/trajectoryStation[1]/commonData/itemState&quot;     
#&gt; [33] &quot;/trajectorys/trajectory/trajectoryStation[2]&quot;                          
#&gt; [34] &quot;/trajectorys/trajectory/trajectoryStation[2]/dTimStn&quot;                  
#&gt; [35] &quot;/trajectorys/trajectory/trajectoryStation[2]/typeTrajStation&quot;          
#&gt; [36] &quot;/trajectorys/trajectory/trajectoryStation[2]/typeSurveyTool&quot;           
#&gt; [37] &quot;/trajectorys/trajectory/trajectoryStation[2]/md&quot;                       
#&gt; [38] &quot;/trajectorys/trajectory/trajectoryStation[2]/tvd&quot;                      
#&gt; [39] &quot;/trajectorys/trajectory/trajectoryStation[2]/incl&quot;                     
#&gt; [40] &quot;/trajectorys/trajectory/trajectoryStation[2]/azi&quot;                      
#&gt; [41] &quot;/trajectorys/trajectory/trajectoryStation[2]/dispNs&quot;                   
#&gt; [42] &quot;/trajectorys/trajectory/trajectoryStation[2]/dispEw&quot;                   
#&gt; [43] &quot;/trajectorys/trajectory/trajectoryStation[2]/vertSect&quot;                 
#&gt; [44] &quot;/trajectorys/trajectory/trajectoryStation[2]/dls&quot;                      
#&gt; [45] &quot;/trajectorys/trajectory/trajectoryStation[2]/rateTurn&quot;                 
#&gt; [46] &quot;/trajectorys/trajectory/trajectoryStation[2]/rateBuild&quot;                
#&gt; [47] &quot;/trajectorys/trajectory/trajectoryStation[2]/gravAccelCorUsed&quot;         
#&gt; [48] &quot;/trajectorys/trajectory/trajectoryStation[2]/magXAxialCorUsed&quot;         
#&gt; [49] &quot;/trajectorys/trajectory/trajectoryStation[2]/sagCorUsed&quot;               
#&gt; [50] &quot;/trajectorys/trajectory/trajectoryStation[2]/magDrlstrCorUsed&quot;</code></pre>
</div>
<div id="creating-dataframes-from-hierarchical-data" class="section level2">
<h2>Creating dataframes from hierarchical data</h2>
<pre class="r"><code># code</code></pre>
</div>
</div>
<div id="notes" class="section level1">
<h1>Notes</h1>
<ul>
<li><p>For the first row of <code>trajectoryStation</code>, which corresponds to the <code>TIE_POINT</code>, make all the empty variables (those not present) as NA. The <code>data.table</code> function works very well evening out those variables that are incomplete but filling them with default values. We see, for instance, that for first member of the <code>trajectoryStation</code>, the variables are only 10, without counting <code>commonData</code>.</p></li>
<li><p>In upcoming versions we should take care of coercing the variables to their corresponding types. By default, in this example, we’ve got all the variables as character. Because we know in advance the data types because of the WITSML standard, we could use the <strong>R</strong> package <code>readr</code> to do the coercion.</p></li>
<li><p>As we get familiar with the WITSML hierarchies, we could start using loops or <code>apply</code> functions to convert a tree structure to dataframes.</p></li>
<li><p>Functions can be implemented later to get the number of trajectory stations, find which <code>trajectoryStation</code> does not have its complete set of variables, or extract a particular trajectory measurement.</p></li>
<li><p>In this example, we used only one well. That’s why we obtained only one trajectory file. Other wells could have more than one trajectory file. Later we could implement a function that scans all the folders and generates a summary statistic of the number of folders, number of files per well, size, etc.</p></li>
</ul>
</div>
<div id="references" class="section level1">
<h1>References</h1>
<p>WITSML 1.3.1.1: <a href="http://w3.energistics.org/schema/witsml_v1.3.1.1_data/doc/WITSML_Schema_docu.htm" class="uri">http://w3.energistics.org/schema/witsml_v1.3.1.1_data/doc/WITSML_Schema_docu.htm</a></p>
<p>WITSML 1.4.0 schema: <a href="http://w3.energistics.org/schema/witsml_v1.4.0_data/doc/witsml_schema_overview.html" class="uri">http://w3.energistics.org/schema/witsml_v1.4.0_data/doc/witsml_schema_overview.html</a></p>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Software Development Kit<a href="#fnref1" class="footnote-back">↩</a></p></li>
<li id="fn2"><p>A Microsoft development platform<a href="#fnref2" class="footnote-back">↩</a></p></li>
<li id="fn3"><p>A Microsoft flavor of C++<a href="#fnref3" class="footnote-back">↩</a></p></li>
</ol>
</div>
